<script>
    function truncateFilePath(path, maxLength = 30) {
        if (path.length <= maxLength) return path;
        const visibleLength = maxLength - 3; // Subtracting 3 to account for the "..."
        return `...${path.slice(-visibleLength)}`;
    }

    function passDownDataToCodeview({hash}) {
        const codeview = document.getElementById('codeview');
        const filesData = { type: 'files', files };
        const thisFileUrlData = { type: 'this-file-url', thisFileUrl: selectedFileData.uri };
        const instaJumpData = { type: 'insta-jump', hash};
        codeview.addEventListener('load', function() {
            codeview.contentWindow.postMessage(filesData, '*');
            codeview.contentWindow.postMessage(thisFileUrlData, '*');
            codeview.contentWindow.postMessage(instaJumpData, '*');
            console.log("Sending insta-jump: ", instaJumpData, " to codeview.");
        });
    }

    window.onload = function () {
        const explorerViewContent = document.getElementById("explorer-view-content");
        for (let i = 0; i < files.length; i++) {
            explorerViewContent.children[i].innerHTML = truncateFilePath(
                files[i].name
            );
            explorerViewContent.children[i].setAttribute("data-tooltip", files[i].name);
        }
        selectFile(0); // default selection
        passDownDataToCodeview();
    };

    let selectedFileData = {};

    function selectFile(fileId, hash) {
        const selectedFile = document.querySelector('.selected');
        if (selectedFile) {
            selectedFile.classList.remove('selected');
        }
        document.getElementById(fileId).classList.add('selected');
        switchCodeview(files[fileId].uri, hash);
    }

    function switchCodeview(uri, hash) {
        selectedFileData = files.find(f => f.uri === uri);
        console.log("new selected file: ", selectedFileData.name, "");
        const codeview = document.getElementById('codeview');
        codeview.src = uri;
        if (hash) {
            codeview.hash = hash;
        }
        console.log("from switch codeview: ", hash);
        passDownDataToCodeview({hash});
    }
</script>

<style>
    * {
        font-family: 'JetBrains Mono', 'Fira Code';
    }

    ul {
        list-style-type: none;
        cursor: pointer;
        height: 2em;
        display: flex;
        align-items: center;
        padding-left: 1em;
        border-radius: 0.5em;
        --anim-length: 0.2s;
        transition: background-color var(--anim-length) ease-in-out,
        color var(--anim-length) ease-in-out;
    }

    ul:hover {
        background-color: #f5e4ff;
        color: black;
    }

    ul.selected:hover,
    .selected {
        background-color: #c25efc;
        color: white;
    }

    ul:hover::after {
        content: attr(data-tooltip);
        position: fixed;
        bottom: 20px;
        left: 50%;
        transform: translateX(-50%);
        background-color: rgba(85, 85, 85, 0.8);
        backdrop-filter: blur(5px);
        color: #fff;
        text-align: center;
        border-radius: 6px;
        padding: 5px;
        white-space: nowrap;
        z-index: 999;
    }
</style>

<!-- <div id="explorer-view-content">
    <ul id="0" onclick="selectFile(0)"></ul>
    <ul id="1" onclick="selectFile(1)"></ul>
    <ul id="2" onclick="selectFile(2)"></ul>
    <ul id="3" onclick="selectFile(3)"></ul>
</div> -->

<!-- 
<script>
const files = [
    {
        name: 'file_1',
        uri: '/Users/tanugayev/Documents/dart-code-visualization/build/html/program_1_dartboard.html'
    },
    {
        name: 'file_2',
        uri: '/Users/tanugayev/Documents/dart-code-visualization/build/html/program_2_dartboard.html'
    },
    {
        name: 'file_3',
        uri: '/Users/tanugayev/Documents/dart-code-visualization/build/html/program_3_dartboard.html'
    }
];
</script> -->