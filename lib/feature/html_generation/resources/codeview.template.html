<style>
    @import url("https://cdn.jsdelivr.net/gh/tonsky/FiraCode@1.207/distr/fira_code.css");
    @import url("https://dev-cats.github.io/code-snippets/JetBrainsMono.css");

    * {
        color: #444;
        scroll-behavior: smooth;
        scroll-padding-top: 5.5em;
        margin-top: 10px;
        animation: fade-in 0.2s ease-in-out;
    }
    
    body {
        background-color: white;
    }

    @keyframes fade-in {
        from {
            opacity: 0;
        }
        to {
            opacity: 1;
        }
    }

    code, .tooltip {
        font-family: 'JetBrains Mono', 'Fira Code';
        font-size: 105%;
    }

    /* todo: span -> div, remove whitespacing at the end */
    div {
    }

    .doc {
        /* background-color: #6a8e231e !important; */
        color: rgba(90, 30, 64, 0.561);
    }

    .block {
        background-color: rgba(0, 0, 0, 0.05);
        cursor: pointer;
        visibility: visible;
    }

    .collapsed {
        /* display: none; */
    }

    .declaration-highlighted {
        background-color: #5e9efc !important;
        color: white !important;
    }

    .variable-usage {
        color: #5e9efc;
    }

    .function-usage {
        color: #2d68c1;
    }

    /* todo add unused code highlighting */
    /* todo add comment highlighting */

    .main {
        color: #fc5e5e;
        font-weight: bold;
        background-color: transparent;
    }

    .quote {
        color: #fc5e5e;
        background-color: transparent;
    }

    .data-type {
        color: #c25efc;
        background-color: transparent;
    }

    .literal {
        color: #000;
        background-color: transparent;
    }

    .keyword {
        color: #ff7c2c;
        background-color: transparent;
    }

    .comment {
        color: #6b8e23;
        background-color: transparent;
    }

    .tooltip {
        position: absolute;
        background-color: #44444480;
        backdrop-filter: blur(5px);
        color: white;
        padding: 0.4em;
        border-radius: 0.5em;
        opacity: 0;
        z-index: 100;
        font-size: smaller;
    }
</style>

<script>
    /////////////////////////
    // Jumping to declarations

    function jumpTo(whereTo) {
        console.log(`Jumping to ${whereTo}`)
        document.getElementById(whereTo).classList.add("declaration-highlighted")
        window.location.hash = whereTo;
        setTimeout(() => {
            document.getElementById(whereTo).classList.remove("declaration-highlighted")
        }, 3000)
    }

    /////////////////////////
    // Block Collapsing

    const collapseTimeout = 100;
    let canCollapse = true;
    let collapseBuffer = {};

    function _initiateCooldown(id) {
        canCollapse = false;
        setTimeout(() => {
            canCollapse = true;
        }, collapseTimeout);
    }

    function collapse(blockId) {
        // this is oncontextmenu, so we need to prevent default
        event.preventDefault();
        if (!canCollapse) return
        // toggling mechanism:
        if (document.getElementById(blockId).classList.contains("collapsed")) {
            // then we want to unravel
            console.log(`Unfolding ${blockId}!`)
            document.getElementById(blockId).classList.remove("collapsed")
            document.getElementById(blockId).innerHTML = collapseBuffer[blockId];
            _initiateCooldown(blockId)
        } else {
            // we want to collapse
            console.log(`Folding ${blockId}!`)
            document.getElementById(blockId).classList.add("collapsed")
            collapseBuffer[blockId] = document.getElementById(blockId).innerHTML;
            document.getElementById(blockId).innerHTML = "...";
            _initiateCooldown(blockId)
        }
    }

    /////////////////////////
    // Tooltip

    function showTooltip(event, elementId, tooltipText) {
        let tooltip = document.getElementById(`tooltip`);

        console.log(`Showing tooltip for ${elementId}! ${tooltipText}`);

        // visibility visible for tooltip
        tooltip.style.opacity = "1";
        // move tooltip to mouse coords
        tooltip.style.left = event.clientX + "px";
        tooltip.style.top = event.clientY + "px";
        // set tooltip text
        tooltip.innerHTML = tooltipText;

    }

    function hideTooltip(event, elementId) {
        let tooltip = document.getElementById(`tooltip`);
        // opacity 0 for tooltip
        tooltip.style.opacity = "0";
    }

    function createTooltip(){
        let tooltip = document.createElement("div");
        tooltip.innerHTML = "<tooltip>";
        tooltip.classList.add("tooltip");
        tooltip.id = `tooltip`;
        document.body.appendChild(tooltip);
    }

    /////////////////////////
    // Window Setup
    window.onload = () => {
        createTooltip();
    }
</script>

<!-- <pre><code>$codeString</code></pre> -->